#define build argument for ubi version
ARG IMAGE=ubi9

#define go version to used
FROM registry.access.redhat.com/${IMAGE}/ubi-minimal
ARG GO_VERSION="1.20.5"
ARG GOLANGARCH="x86_64"

#install necessary tools (wget, tar, and other dependencies)
RUN microdnf install -y \
    wget \
    tar \
    gcc \
    make \
    && microdnf clean all

#download and install Go
RUN echo ${GO_VERSION}} ${GOLANGARCH} \ 
    && wget https://golang.org/dl/go${GO_VERSION}.linux-${GOLANGARCH}.tar.gz \
    && tar -C /usr/local -xzf go${GO_VERSION}.linux-${GOLANGARCH}.tar.gz \
    && rm go${GO_VERSION}.linux-${GOLANGARCH}.tar.gz

#set up Go environment variables
ENV PATH="/usr/local/go/bin:${PATH}"

#verify the Go installation
RUN go version

#set the default command to go
CMD ["go", "version"]
